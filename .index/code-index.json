{
  "version": 1,
  "generated": "2025-08-25T18:34:17.566Z",
  "files": [
    {
      "path": "README.md",
      "hash": "6074eb23bd8014fb0d25cd89e3682cf3b2e44fd3c58e98d4f440701d3d62e3bd",
      "content": "# Actuarial Toolkit\n\n## Overview\nThis project models how lifestyle factors and preventive screenings influence life expectancy. The app now consists of only three runtime files:\n\n- `index.html` – markup and user interface.\n- `style.css` – all styles for layout and components.\n- `script.js` – bundled JavaScript containing datasets, UI logic, and the longevity model.\n\n## Hazard‑ratio model in detail\n1. **Baseline hazards** – Mortality probabilities (`qx`) are taken from the 2022 U.S. life table. For example, a 35‑year‑old female has an annual mortality probability `qx = 0.00102` (≈0.10%). These are converted to instantaneous hazards `µ` via `µ = -ln(1 - qx)`.\n2. **Behavioral multipliers** – For each risk factor the model uses published hazard ratios (HR):\n   - Smoking: current smokers HR = 2.8; quitting reduces risk linearly to 1.0 after 20 years.\n   - Physical activity: hazard decreases to 0.53 at ≥60 MET‑hours/week.\n   - Body mass index: BMI 30 has HR ≈1.45 relative to reference BMI 22.5–<25.\n   - Alcohol: two drinks/day corresponds to HR ≈1.06 with a monotonic dose curve.\n   These HRs multiply to form a combined proportional hazard for all-cause mortality.\n3. **Adjusted mortality** – The baseline hazard `µ_base` is scaled by the product of HRs to obtain an adjusted hazard: `µ_adj = µ_base × HR_total`. The adjusted annual probability becomes `qx_adj = 1 - exp(-µ_adj)`.\n4. **Life table integration** – The model constructs life tables from both baseline and adjusted `qx` to compute survival (`S_x`) and remaining life expectancy (`e_x`).\n5. **Healthy life expectancy (optional)** – If quality adjustment is toggled, person‑years are weighted by age‑specific “healthy” proportions using the Sullivan method.\n6. **Screening benefits** – Preventive screenings (colorectal and breast) add fixed life‑years and QALYs per participant from modeling studies.\n\n## Sample calculation\nConsider a 35‑year‑old female who currently smokes, performs no structured exercise, has BMI 30, and drinks two alcoholic beverages per day. No screenings are assumed.\n\n1. Baseline hazard at age 35: `qx = 0.00102` → `µ_base ≈ 0.00102`.\n2. Hazard ratios:\n   - Smoking HR = 2.8.\n   - Physical activity HR = 1.00 (inactivity is reference).\n   - BMI HR = 1.45.\n   - Alcohol HR ≈ 1.06 for 2 drinks/day.\n   Combined `HR_total = 2.8 × 1.00 × 1.45 × 1.06 ≈ 4.30`.\n3. Adjusted hazard at age 35: `µ_adj = 0.00102 × 4.30 ≈ 0.00439` → `qx_adj = 1 − exp(-0.00439) ≈ 0.00438` (0.44% annual mortality).\n4. Repeating this transformation for all ages yields adjusted survival curves. Running the model gives:\n   - Baseline remaining life expectancy `LE_base = 72.23` years (total lifespan ≈107.2).\n   - Adjusted remaining life expectancy `LE_adj = 62.38` years.\n   - **Delta:** `LE_adj − LE_base = −9.85` years.\n   Contribution breakdown: smoking −5.79 y, BMI −1.56 y, alcohol −0.21 y.\n\nThus in this scenario, the combined behavioral factors shorten expected lifespan by almost ten years compared to baseline population averages.\n\n## Running locally\nSimply open `index.html` in a modern browser. All assets and datasets are embedded so no server is required.\n\n## Sample usage\n1. Enter age, sex, and behavior inputs.\n2. Click **Recalculate** to view life expectancy and healthy life expectancy results.\n3. Use the download button to export survival curves to CSV.\n\n## Disclaimer\nThe model uses population-level associations and period life tables. It does not provide medical advice and does not account for individual medical histories.\n"
    },
    {
      "path": "index.html",
      "hash": "070298691b8c314aafd11617cd8c22c4ed6b51793f249de81f1129faf7b05b7d",
      "content": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, viewport-fit=cover\" />\n  <title>Actuarial Toolkit</title>\n  <link rel=\"icon\" href=\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14'>😊</text></svg>\" />\n  <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\n  <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap\" rel=\"stylesheet\" />\n  <script>\n    window.tailwind = window.tailwind || {};\n    tailwind.config = {\n      theme: {\n        extend: {\n          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },\n          keyframes: {\n            fadeUp: { '0%':{opacity:0,transform:'translateY(8px) scale(.98)'}, '100%':{opacity:1,transform:'translateY(0) scale(1)'}},\n            shimmer: { '0%':{backgroundPosition:'-468px 0'}, '100%':{backgroundPosition:'468px 0'}},\n            floaty: { '0%':{transform:'translateY(0px)'}, '50%':{transform:'translateY(-8px)'}, '100%':{transform:'translateY(0px)'} }\n          },\n          animation: { fadeUp:'fadeUp .4s cubic-bezier(.2,.8,.2,1) both', floaty:'floaty 6s ease-in-out infinite' },\n          boxShadow: { card:'0 8px 24px rgba(2, 6, 23, .06)' }\n        }\n      }\n    }\n  </script>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <link rel=\"stylesheet\" href=\"./style.css\" />\n</head>\n<body class=\"bg-slate-50 text-slate-900 antialiased\">\n  <header class=\"max-w-5xl mx-auto px-4 py-6 bg-white rounded-xl shadow\">\n    <div class=\"flex flex-col sm:flex-row items-start sm:items-center gap-4 mb-4 motion-safe:animate-fadeUp\">\n      <div class=\"w-16 h-16 rounded-2xl bg-yellow-100 flex items-center justify-center text-3xl shadow bouncy select-none text-slate-900\" aria-hidden=\"true\" title=\"Hi!\">🙂</div>\n      <div class=\"flex-1 min-w-0\">\n        <h1 class=\"text-2xl md:text-3xl font-bold tracking-tight text-slate-900\">Actuarial Toolkit</h1>\n        <p class=\"text-slate-600\">Crunch the numbers and outwit risk.</p>\n      </div>\n      <div class=\"flex items-center gap-4 text-sm\">\n        <a class=\"inline-flex items-center gap-1 underline\" href=\"https://instagram.com/luisitin2001\" target=\"_blank\" rel=\"noopener\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"w-4 h-4\" fill=\"currentColor\">\n            <path d=\"M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11zm0 2a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7zM18 6.2a1 1 0 1 1 0 2 1 1 0 0 1 0-2z\"/>\n          </svg>\n          Instagram\n        </a>\n        <span class=\"text-slate-400\">&bull;</span>\n        <a class=\"inline-flex items-center gap-1 underline\" href=\"https://www.tiktok.com/@luisitin2001\" target=\"_blank\" rel=\"noopener\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" class=\"w-4 h-4\" fill=\"currentColor\">\n            <path d=\"M30 6c1.6 3.6 4.6 6.3 8.3 7.2v6.1c-3.2-.1-6.2-1.1-8.7-2.8v12.3c0 7.1-5.7 12.8-12.8 12.8S4 35.9 4 28.8s5.7-12.8 12.8-12.8c1.2 0 2.4.2 3.5.5v6.4c-.9-.4-1.9-.6-3-.6-3.4 0-6.3 2.8-6.3 6.3s2.8 6.3 6.3 6.3 6.3-2.8 6.3-6.3V6h6.4z\"/>\n          </svg>\n          TikTok\n        </a>\n      </div>\n    </div>\n    <div class=\"mt-3 flex items-center justify-between text-sm text-slate-600 px-3 py-2 bg-white rounded-lg border\">\n      <div class=\"flex items-center gap-2\">\n        <span class=\"px-2 py-0.5 rounded bg-slate-100 text-slate-600\">Fun fact</span>\n        <span id=\"fun-fact\" class=\"motion-safe:animate-fadeUp text-slate-600\"></span>\n      </div>\n      <button id=\"shuffle-fact\" class=\"icon-btn hover:bg-slate-100\" aria-label=\"Shuffle fun fact\" title=\"Shuffle fun fact\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"w-4 h-4\" fill=\"currentColor\">\n          <path d=\"M7 3v2h.59L5 8.59 6.41 10 10 6.41V7h2V3H7zm10 0h4v4h-2V6.41l-3.29 3.3-1.42-1.42L17.59 5H17V3zM3 13h4v-2H3v2zm6.71 3.29 1.42 1.42L5 23h2v-2h.59l3.3-3.29-1.18-1.42zM19 14h2v4h-4v-2h1.59l-3.29-3.29 1.42-1.42L19 14.59V14z\"/>\n        </svg>\n      </button>\n    </div>\n  </header>\n\n  <section class=\"card max-w-5xl mx-auto mb-4\" aria-labelledby=\"tool-title\">\n    <div class=\"flex items-center justify-between mb-4\">\n      <h2 id=\"tool-title\">Pick a Tool</h2>\n      <span class=\"text-xs text-slate-500\">Everything updates automatically</span>\n    </div>\n    <div id=\"toolTabs\" class=\"flex gap-2 overflow-x-auto pb-2\">\n      <button type=\"button\" class=\"border rounded-2xl px-3 py-2 text-left transition-colors flex-shrink-0 bg-slate-900 text-white\" data-tool=\"longevity-lab\">Longevity Lab</button>\n      <button data-tool=\"methodology\" class=\"border rounded-2xl px-3 py-2 bg-white hover:bg-slate-50\">Methodology</button>\n    </div>\n  </section>\n\n  <div class=\"pointer-events-none fixed inset-0 overflow-hidden -z-10\" aria-hidden=\"true\">\n    <div class=\"absolute -top-24 -left-24 w-72 h-72 rounded-full bg-gradient-to-br from-amber-200 to-pink-200 blur-3xl opacity-60 animate-floaty\"></div>\n    <div class=\"absolute -bottom-24 -right-24 w-80 h-80 rounded-full bg-gradient-to-br from-emerald-200 to-sky-200 blur-3xl opacity-60 animate-floaty\" style=\"animation-delay:-2.2s;\"></div>\n  </div>\n\n  <main class=\"relative\">\n      <section id=\"longevity-lab\" class=\"card tool\" aria-labelledby=\"longevity-title\">\n        <h2 id=\"longevity-title\">Longevity Lab</h2>\n\n        <button type=\"button\" class=\"what-btn\" data-toggle=\"disc-main\" aria-expanded=\"false\" aria-controls=\"disc-main\">What is this?</button>\n        <p id=\"disc-main\" class=\"disclaimer\" role=\"note\" hidden>\n          Population-level estimates from U.S. life tables and hazard ratios. Not medical advice.\n        </p>\n\n      <div class=\"grid two-col\" id=\"controls\">\n        <div>\n          <fieldset aria-describedby=\"disclaimer-controls\">\n            <legend>Profile</legend>\n            <label class=\"inline\">Age\n              <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Age info\">\n                i\n                <span class=\"info-tip\" role=\"tooltip\" id=\"age-tip\">Your current age. Used to look up the baseline mortality rate.</span>\n              </button>\n              <input id=\"age\" class=\"field\" type=\"number\" min=\"20\" max=\"100\" inputmode=\"numeric\" placeholder=\"35\" aria-describedby=\"age-tip\" />\n            </label>\n            <label class=\"inline\">Sex\n              <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Sex info\">\n                i\n                <span class=\"info-tip\" role=\"tooltip\" id=\"sex-tip\">Biological sex (female or male). Determines which life table (F or M) to use.</span>\n              </button>\n              <select id=\"sex\" class=\"field\" aria-describedby=\"sex-tip\">\n                <option value=\"F\">Female</option>\n                <option value=\"M\">Male</option>\n              </select>\n            </label>\n          </fieldset>\n\n            <fieldset>\n              <legend>Behaviors</legend>\n\n              <hr class=\"my-4\" />\n\n              <label class=\"inline\">Smoking\n                <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Smoking info\">\n                  i\n                  <span class=\"info-tip\" role=\"tooltip\" id=\"smoking-tip\">Select ‘Never’ if you’ve never smoked, ‘Current’ if you smoke now, or ‘Former’ if you quit.</span>\n                </button>\n                <select id=\"smoking\" class=\"field\" aria-describedby=\"smoking-tip\">\n                  <option value=\"never\">Never</option>\n                  <option value=\"current\">Current</option>\n                  <option value=\"former\">Former</option>\n                </select>\n              </label>\n\n              <label id=\"ysq-wrap\" class=\"inline\" hidden>Years since quit\n                <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Years since quit info\">\n                  i\n                  <span class=\"info-tip\" role=\"tooltip\" id=\"ysq-tip\">If you used to smoke, how many years ago you quit. Reduces your hazard ratio as the years increase.</span>\n                </button>\n                <input id=\"yearsSinceQuit\" class=\"field\" type=\"number\" min=\"0\" max=\"60\" placeholder=\"5\" aria-describedby=\"ysq-tip\" />\n              </label>\n\n              <label id=\"alcohol-wrap\" class=\"inline\">Alcohol (drinks/day)\n                <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Alcohol info\">\n                  i\n                  <span class=\"info-tip\" role=\"tooltip\" id=\"alcohol-tip\">Average number of standard drinks you have per day.</span>\n                </button>\n                <select id=\"alcohol\" class=\"field\" aria-describedby=\"alcohol-tip\">\n                  <option value=\"0\">None</option>\n                  <option value=\"1\">1/day</option>\n                  <option value=\"2\">2/day</option>\n                  <option value=\"3\">3/day</option>\n                  <option value=\"4\">4/day</option>\n                  <option value=\"5\">5/day</option>\n                  <option value=\"6\">6+/day</option>\n                </select>\n              </label>\n\n              <hr class=\"my-4\" />\n\n              <label class=\"inline\">Physical activity\n                <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Physical activity info\">\n                  i\n                  <span class=\"info-tip\" role=\"tooltip\" id=\"activity-tip\">Select your typical weekly activity. We'll estimate MET-hours/week.</span>\n                </button>\n                <select id=\"activityLevel\" class=\"field\" aria-describedby=\"activity-tip\">\n                  <option value=\"none\">Little to none</option>\n                  <option value=\"light\">1-2 days light exercise</option>\n                  <option value=\"moderate\">3-5 days moderate exercise</option>\n                  <option value=\"high\">6-7 days vigorous exercise</option>\n                </select>\n              </label>\n\n              <label class=\"inline\">Weight (lbs)\n                <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Weight info\">\n                  i\n                <span class=\"info-tip\" role=\"tooltip\" id=\"weight-tip\">Your weight in pounds (lbs). Used to compute Body Mass Index (BMI).</span>\n              </button>\n              <input id=\"weight\" class=\"field\" type=\"number\" min=\"50\" max=\"1000\" step=\"0.1\" placeholder=\"160\" aria-describedby=\"weight-tip\" />\n            </label>\n\n              <label class=\"inline\">Height\n                <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Height info\">\n                  i\n                  <span class=\"info-tip\" role=\"tooltip\" id=\"height-tip\">Your height in feet and inches. Also used to compute BMI.</span>\n                </button>\n                <div class=\"flex items-center gap-2\">\n                  <input id=\"heightFeet\" class=\"field w-16\" type=\"number\" min=\"3\" max=\"8\" step=\"1\" placeholder=\"5\" aria-label=\"Height feet\" aria-describedby=\"height-tip\" /> <span>ft</span>\n                  <input id=\"heightInches\" class=\"field w-16\" type=\"number\" min=\"0\" max=\"11\" step=\"1\" placeholder=\"9\" aria-label=\"Height inches\" aria-describedby=\"height-tip\" /> <span>in</span>\n                </div>\n              </label>\n\n              <hr class=\"my-4\" />\n\n              <button type=\"button\" class=\"what-btn\" data-toggle=\"disc-behav\" aria-expanded=\"false\" aria-controls=\"disc-behav\">What is this?</button>\n              <small id=\"disc-behav\" class=\"disclaimer\" hidden>\n                Associations, not causation. Hazard ratios drawn from large cohort/meta analyses; simplifications apply.\n              </small>\n            </fieldset>\n\n          <fieldset id=\"screening_fs\">\n            <legend class=\"inline\">Preventive screening\n              <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Preventive screening info\">\n                i\n                <span class=\"info-tip\" role=\"tooltip\" id=\"screening-tip\">Adds extra life-years based on USPSTF recommendations.</span>\n              </button>\n            </legend>\n            <div id=\"crc_wrap\" hidden>\n              <label class=\"inline\" for=\"crc_screen\">\n                <span class=\"flex-1\">Have you gotten a colorectal screening done?</span>\n                <select id=\"crc_screen\" class=\"field\">\n                  <option value=\"no\">No</option>\n                  <option value=\"yes\">Yes</option>\n                </select>\n              </label>\n              <span class=\"block text-slate-600 text-sm\">Helps detect colorectal cancer early.</span>\n            </div>\n            <div id=\"breast_wrap\" hidden>\n              <label class=\"inline\" for=\"breast_screen\">\n                <span class=\"flex-1\">Have you gotten a breast cancer screening done?</span>\n                <select id=\"breast_screen\" class=\"field\">\n                  <option value=\"no\">No</option>\n                  <option value=\"yes\">Yes</option>\n                </select>\n              </label>\n              <span class=\"block text-slate-600 text-sm\">Helps detect breast cancer early.</span>\n            </div>\n            <button type=\"button\" class=\"what-btn\" data-toggle=\"disc-screen\" aria-expanded=\"false\" aria-controls=\"disc-screen\">What is this?</button>\n            <small id=\"disc-screen\" class=\"disclaimer\" hidden>Modeled as additive life-years/QALYs from published decision analyses.</small>\n          </fieldset>\n\n          <label class=\"inline\">\n            <input id=\"qualityToggle\" type=\"checkbox\" aria-describedby=\"quality-tip\" />\n            Show quality-adjusted years\n            <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Quality adjusted years info\">\n              i\n              <span class=\"info-tip\" role=\"tooltip\" id=\"quality-tip\">When on, uses healthy life expectancy (HALE) and QALY gains instead of plain life expectancy.</span>\n            </button>\n          </label>\n\n            <div class=\"actions\">\n              <button id=\"runBtn\" class=\"primary\">Recalculate</button>\n              <button id=\"assumptionsBtn\" type=\"button\" class=\"secondary\">Assumptions &amp; Data Sources</button>\n            </div>\n            <button type=\"button\" class=\"what-btn\" data-toggle=\"disclaimer-controls\" aria-expanded=\"false\" aria-controls=\"disclaimer-controls\">What is this?</button>\n            <small id=\"disclaimer-controls\" class=\"disclaimer\" hidden>\n              Uses period life tables and hazard ratios. Not medical advice.\n            </small>\n          </div>\n\n        <div id=\"summary\" aria-live=\"polite\">\n          <div class=\"flex justify-end mb-2\">\n            <button type=\"button\" class=\"icon-btn info-btn\" aria-label=\"Life expectancy explanations\">\n              i\n              <span class=\"info-tip\" role=\"tooltip\" id=\"summary-tip\">Life expectancy is total expected years. Healthy life expectancy counts only years in good health.</span>\n            </button>\n          </div>\n\n          <div class=\"stat\">\n            <div class=\"stat-label\">Life expectancy (total years)</div>\n            <div class=\"stat-value\">\n              <span id=\"le_baseline\">–</span> → <span id=\"le_adjusted\">–</span>\n            </div>\n            <div class=\"stat-delta\"><span id=\"le_delta\">+0.0</span> years</div>\n          </div>\n\n          <div class=\"stat\" id=\"hale-row\" hidden>\n            <div class=\"stat-label\">Healthy life expectancy (healthy years)</div>\n            <div class=\"stat-value\">\n              <span id=\"hale_baseline\">–</span> → <span id=\"hale_adjusted\">–</span>\n            </div>\n            <div class=\"stat-delta\"><span id=\"hale_delta\">+0.0</span> years</div>\n          </div>\n\n          <div id=\"contrib\" class=\"contrib\"></div>\n\n          <div class=\"actions\">\n            <button id=\"downloadCsv\" type=\"button\">Download CSV</button>\n          </div>\n\n          <button type=\"button\" class=\"what-btn\" data-toggle=\"disc-csv\" aria-expanded=\"false\" aria-controls=\"disc-csv\">What is this?</button>\n          <small id=\"disc-csv\" class=\"disclaimer\" hidden>\n            CSV includes this disclaimer and method summary in its header rows. Interpret with caution.\n          </small>\n        </div>\n      </div>\n\n      <div class=\"chart\" id=\"survivalChart\" aria-label=\"Survival curves baseline vs adjusted\"></div>\n      <hr class=\"graph-divider\" />\n      <div class=\"chart\" id=\"cdfChart\" aria-label=\"Cumulative probability of death by age\"></div>\n\n        <dialog id=\"assumptionsModal\" aria-labelledby=\"assumptionsTitle\">\n          <h3 id=\"assumptionsTitle\">Assumptions &amp; Data Sources</h3>\n          <div id=\"assumptionsBody\" class=\"assumptions-body\">\n            <button type=\"button\" class=\"what-btn\" data-toggle=\"assump-method\" aria-expanded=\"false\" aria-controls=\"assump-method\">What is this?</button>\n            <p id=\"assump-method\" hidden><strong>Method:</strong> Period U.S. life table → annual hazards; apply behavior hazard ratios multiplicatively (proportional hazards). Preventive screenings added as life-years/QALYs from published models. HALE via Sullivan method: person-years weighted by “healthy” prevalence.</p>\n\n            <p><strong>Data files used in this app (static JSON):</strong></p>\n            <ul>\n              <li><code>data/lifetable_US_2022.json</code> — Period life table (qx by age/sex), adapted from U.S. NCHS 2022 life table.</li>\n              <li><code>data/hr_physical_activity.json</code> — Relative risks by MET-hours/week bins from pooled cohort analysis.</li>\n              <li><code>data/hr_bmi.json</code> — BMI category hazard ratios (never-smokers reference ≈ 22.5–&lt;25).</li>\n              <li><code>data/hr_smoking.json</code> — Current smoker HR and former-smoker HR decay by years-since-quit.</li>\n              <li><code>data/hr_alcohol.json</code> — Dose-response HR vs drinks/day, conservative (no protective effect).</li>\n              <li><code>data/screening_crc.json</code>, <code>data/screening_breast.json</code> — Life-years/QALYs gained per 1,000 screened.</li>\n              <li><code>data/hale_weights.json</code> — Age-specific “healthy” prevalence for Sullivan HALE.</li>\n            </ul>\n            <button type=\"button\" class=\"what-btn\" data-toggle=\"assump-limits\" aria-expanded=\"false\" aria-controls=\"assump-limits\">What is this?</button>\n            <p id=\"assump-limits\" hidden><strong>Limits &amp; Disclaimers:</strong> Associations ≠ causation; population averages; no comorbidity interactions; period table holds future mortality trends fixed; screening deltas are model-based and simplified to per-person averages. Not medical advice.</p>\n            <button id=\"closeAssumptions\" class=\"secondary\">Close</button>\n          </div>\n        </dialog>\n      </section>\n\n      <section id=\"methodology\" class=\"card tool\" hidden>\n        <h2>Methodology</h2>\n        <select id=\"methodology-select\" class=\"field\">\n          <option value=\"\" disabled selected>Select variable...</option>\n          <option value=\"smoking\">Smoking</option>\n          <option value=\"physical_activity\">Physical Activity</option>\n          <option value=\"bmi\">BMI</option>\n          <option value=\"alcohol\">Alcohol</option>\n          <option value=\"diet\">Diet</option>\n          <option value=\"blood_pressure_cholesterol\">Blood Pressure/Cholesterol</option>\n          <option value=\"diabetes\">Diabetes</option>\n          <option value=\"sleep\">Sleep</option>\n          <option value=\"socioeconomic_status\">Socioeconomic Status</option>\n          <option value=\"colorectal_screening\">Colorectal Screening</option>\n          <option value=\"breast_screening\">Breast Screening</option>\n        </select>\n        <div id=\"methodology-content\" class=\"mt-4\"></div>\n      </section>\n    </main>\n\n  <noscript>\n    <div class=\"max-w-xl mx-auto mt-12 p-4 rounded-xl bg-white/80 border\">\n      Please enable JavaScript to use the Fitness Toolkit.\n    </div>\n  </noscript>\n\n  <script src=\"script.js\"></script>\n</body>\n</html>\n"
    },
    {
      "path": "script.js",
      "hash": "ece5ed75d83af4bcc700472816fb954ada833e9dcef0f1846d2c422af475eb52",
      "content": "// Consolidated JavaScript for Actuarial Toolkit\n// Data previously in separate JSON files\nconst datasets = {\n  lifetable_US_2022:  { \"F\": { \"qx\": { \"0\": 0.00527, \"1\": 0.00040, \"5\": 0.00012, \"10\": 0.00008, \"15\": 0.00029, \"20\": 0.00052, \"25\": 0.00062, \"30\": 0.00074, \"35\": 0.00102, \"40\": 0.00142, \"45\": 0.00206, \"50\": 0.00305, \"55\": 0.00453, \"60\": 0.00677, \"65\": 0.01010, \"70\": 0.01547, \"75\": 0.02447, \"80\": 0.03967, \"85\": 0.06540, \"90\": 0.10800, \"95\": 0.17600, \"100\": 0.28000, \"105\": 0.45000, \"110\": 1.0 }}, \"M\": { \"qx\": { \"0\": 0.00559, \"1\": 0.00045, \"5\": 0.00013, \"10\": 0.00009, \"15\": 0.00037, \"20\": 0.00079, \"25\": 0.00096, \"30\": 0.00116, \"35\": 0.00157, \"40\": 0.00220, \"45\": 0.00317, \"50\": 0.00463, \"55\": 0.00693, \"60\": 0.01048, \"65\": 0.01580, \"70\": 0.02405, \"75\": 0.03733, \"80\": 0.05941, \"85\": 0.09502, \"90\": 0.15000, \"95\": 0.23000, \"100\": 0.35000, \"105\": 0.52000, \"110\": 1.0 }}, \"source\": \"Arias E, Tejada-Vera B. United States Life Tables, 2022. National Vital Statistics Reports; vol 73 no 1. 2024\" },\n  hr_physical_activity:  { \"bins_MET_h_week\": [0, 7.5, 15, 22.5, 37.5, 60, 90], \"HR\": [1.00, 0.81, 0.69, 0.61, 0.55, 0.53, 0.53], \"source\": \"Arem H et al. Leisure time physical activity and mortality. JAMA Intern Med 2015\" },\n  hr_bmi:  { \"bins_BMI\": [0, 18.5, 22.5, 25, 27.5, 30, 35, 40, 70], \"HR\": [1.22, 1.00, 1.00, 1.07, 1.20, 1.45, 1.94, 2.76], \"source\": \"Global BMI Mortality Collaboration. Body-mass index and all-cause mortality. Lancet 2016\" },\n  hr_smoking:  { \"current\": 2.80, \"former_decay\": [ { \"years\": 0, \"HR\": 2.0 }, { \"years\": 5, \"HR\": 1.5 }, { \"years\": 10, \"HR\": 1.2 }, { \"years\": 15, \"HR\": 1.05 }, { \"years\": 20, \"HR\": 1.00 } ], \"never\": 1.00, \"source\": \"Jha P et al. 21st-Century hazards of smoking and benefits of cessation in the United States. N Engl J Med 2013\" },\n  hr_alcohol:  { \"gramsPerDrink\": 14, \"dose_HR\": [ { \"drinksPerDay\": 0, \"HR\": 1.00 }, { \"drinksPerDay\": 1, \"HR\": 1.03 }, { \"drinksPerDay\": 2, \"HR\": 1.06 }, { \"drinksPerDay\": 3, \"HR\": 1.12 }, { \"drinksPerDay\": 4, \"HR\": 1.20 }, { \"drinksPerDay\": 6, \"HR\": 1.40 } ], \"source\": \"Wood AM et al. Risk thresholds for alcohol consumption. Lancet 2018\" },\n  screening_crc:  { \"default_schedule\": { \"startAge\": 45, \"stopAge\": 75, \"modality\": \"mixed\" }, \"LYG_per_1000\": 260, \"QALY_per_1000\": 210, \"source\": \"Knudsen AB et al. Colorectal cancer screening: updated modeling study for the USPSTF. JAMA 2021\" },\n  screening_breast:  { \"default_schedule\": { \"startAge\": 40, \"stopAge\": 74, \"intervalYears\": 2 }, \"LYG_per_1000\": 60, \"QALY_per_1000\": 45, \"source\": \"U.S. Preventive Services Task Force. Screening for Breast Cancer: Recommendation Statement. Ann Intern Med. 2016\" },\n  hale_weights:  { \"F\": { \"0\": 0.98, \"10\": 0.97, \"20\": 0.96, \"30\": 0.95, \"40\": 0.93, \"50\": 0.90, \"60\": 0.85, \"70\": 0.78, \"80\": 0.68, \"90\": 0.50, \"100\": 0.30 }, \"M\": { \"0\": 0.98, \"10\": 0.97, \"20\": 0.96, \"30\": 0.95, \"40\": 0.92, \"50\": 0.88, \"60\": 0.82, \"70\": 0.74, \"80\": 0.63, \"90\": 0.45, \"100\": 0.28 }, \"source\": \"IHME. Global Burden of Disease Study 2019 (HALE)\" }\n};\n\nasync function loadAllData(){ return datasets; }\n\nconst state = {\n  age: 35, sex: 'F',\n  smoking: 'never', yearsSinceQuit: 0,\n  metHours: null,\n  weight: 160,\n  heightFt: 5,\n  heightIn: 9,\n  alcoholDrinks: 0,\n  crc: false,\n  breast: false,\n  quality: false\n};\nconst listeners = [];\n\nfunction getState(){ return state; }\nfunction setState(patch){ Object.assign(state, patch); listeners.forEach(fn=>fn(state)); }\nfunction onStateChange(fn){ listeners.push(fn); }\n\nfunction initStateFromURL(){\n  const sParam = new URLSearchParams(location.search).get('s');\n  let loaded = false;\n  if (sParam){\n    try{ Object.assign(state, JSON.parse(decodeURIComponent(atob(sParam)))); loaded=true; }catch{}\n  }\n  if (!loaded){\n    try{\n      const saved = JSON.parse(localStorage.getItem('longevity_state')||'{}');\n      Object.assign(state, saved);\n    }catch{}\n  }\n}\n\nfunction saveToLocal(){\n  localStorage.setItem('longevity_state', JSON.stringify(state));\n}\n// Map inputs -> hazard ratios. Keep simple binning + linear interpolation. Labels for UI contrib output.\nconst hrLabels = {\n  smoking:'Smoking', activity:'Physical activity', bmi:'BMI', alcohol:'Alcohol'\n};\n\nfunction hrSmoking(smoking){ // {status, yearsSinceQuit}\n  // Defaults if dataset missing:\n  const currentHR = 2.8;\n  const decay = [ // years:HR\n    {years:0,HR:2.0},{years:5,HR:1.5},{years:10,HR:1.2},{years:15,HR:1.05},{years:20,HR:1.0}\n  ];\n  if (smoking.status==='never') return 1.0;\n  if (smoking.status==='current') return currentHR;\n  const t = Math.max(0, smoking.yearsSinceQuit||0);\n  // piecewise linear interpolate decay\n  let prev=decay[0]; for(let i=1;i<decay.length;i++){\n    const cur=decay[i]; if(t<=cur.years){\n      const w=(t-prev.years)/(cur.years-prev.years);\n      return prev.HR + w*(cur.HR-prev.HR);\n    } prev=cur;\n  }\n  return decay[decay.length-1].HR;\n}\n\nfunction hrActivity(met, table){\n  // bins and HRs from dataset or fallback conservative curve\n  const bins = table?.bins_MET_h_week || [0,7.5,15,22.5,37.5,60,90];\n  const HRs  = table?.HR || [1.00,0.81,0.69,0.61,0.55,0.53,0.53];\n  return interpolateBins(met, bins, HRs);\n}\n\nfunction hrBmiFn(bmi, table){\n  const bins = table?.bins_BMI || [0,18.5,22.5,25,27.5,30,35,40,70];\n  const HRs  = table?.HR || [1.22,1.00,1.00,1.07,1.20,1.45,1.94,2.76];\n  return interpolateBins(bmi, bins, HRs);\n}\n\nfunction hrAlcohol(drinks, table){\n  const pts = table?.dose_HR || [\n    {drinksPerDay:0,HR:1.00},{drinksPerDay:1,HR:1.03},{drinksPerDay:2,HR:1.06},{drinksPerDay:3,HR:1.12},{drinksPerDay:4,HR:1.20},{drinksPerDay:6,HR:1.40}\n  ];\n  if (drinks<=pts[0].drinksPerDay) return pts[0].HR;\n  for (let i=1;i<pts.length;i++){\n    const a=pts[i-1], b=pts[i];\n    if (drinks<=b.drinksPerDay){\n      const w=(drinks-a.drinksPerDay)/(b.drinksPerDay-a.drinksPerDay);\n      return a.HR + w*(b.HR-a.HR);\n    }\n  }\n  // extrapolate last slope\n  const a=pts[pts.length-2], b=pts[pts.length-1];\n  const slope=(b.HR-a.HR)/(b.drinksPerDay-a.drinksPerDay);\n  return b.HR + slope*(drinks-b.drinksPerDay);\n}\n\nfunction interpolateBins(x, bins, vals){\n  if (x<=bins[0]) return vals[0];\n  for (let i=1;i<bins.length;i++){\n    if (x<=bins[i]){\n      const w=(x-bins[i-1])/(bins[i]-bins[i-1]);\n      const a=vals[i-1], b=vals[i];\n      return a + w*(b-a);\n    }\n  }\n  return vals[vals.length-1];\n}\n// Lightweight SVG line charts (no external lib). Two series max expected, but supports many.\nfunction drawLines(containerId, series, opts={}){\n  const el = document.getElementById(containerId);\n  if (!el) return;\n  el.innerHTML = '';\n  const W = el.clientWidth || 640;\n  const H = opts.height || 280;\n  const m = {t:30,r:20,b:60,l:50};\n\n  if (opts.title){\n    const t = document.createElement('div');\n    t.className = 'chart-title';\n    t.textContent = opts.title;\n    el.appendChild(t);\n  }\n\n  const svg = h('svg',{viewBox:`0 0 ${W} ${H}`,width:'100%',height:H,role:'img'});\n  el.appendChild(svg);\n\n  // Flatten domains\n  const xs = series.flatMap(s=>s.x);\n  const ys = series.flatMap(s=>s.y);\n  const xMin = Math.min(...xs), xMax = Math.max(...xs);\n  const yMin = Math.min(0, ...ys);\n  const yMax = opts.yPercent ? 1 : Math.max(1, ...ys);\n\n  const sx = v => m.l + (v-xMin)/(xMax-xMin) * (W-m.l-m.r);\n  const sy = v => H - m.b - (v-yMin)/(yMax-yMin) * (H-m.t-m.b);\n\n  // axes\n  line(m.l,H-m.b,W-m.r,H-m.b, '#aaa'); // x\n  line(m.l,m.t,m.l,H-m.b, '#aaa');     // y\n  text(W-m.r, H-m.b+40, opts.xLabel||'', 'end');\n\n  // ticks (simple)\n  for (let a = Math.ceil(xMin/10)*10; a<=xMax; a+=10){\n    const x=sx(a); line(x,H-m.b,x,H-m.b+6,'#aaa'); text(x,H-m.b+24,''+a,'middle');\n  }\n  const yStep = opts.yPercent ? 0.25 : 0.25;\n  for (let p=0; p<=1.0001; p+=yStep){\n    const y=sy(p);\n    const label = opts.yPercent ? `${Math.round(p*100)}%` : ''+p;\n    line(m.l,y,m.l-6,y,'#aaa');\n    text(m.l-12,y,label,'end','middle');\n  }\n\n  // lines\n  series.forEach((s,i)=>{\n    const d = s.x.map((x,j)=>`${j?'L':'M'} ${sx(x)} ${sy(s.y[j])}`).join(' ');\n    const path = h('path',{d,fill:'none',stroke: i? 'currentColor' : '#888', 'stroke-width':2});\n    svg.appendChild(path);\n    // legend\n    const ly = m.t + 16*i;\n    const sw = h('rect',{x:W-m.r-100,y:ly-8,width:24,height:3,fill:i?'currentColor':'#888'}); svg.appendChild(sw);\n    text(W-m.r-70, ly, s.name||`Series ${i+1}`,'start','middle');\n  });\n\n  if (opts.disclaimer){\n    const note = document.createElement('div');\n    note.className = 'chart-note';\n    note.textContent = 'Population-level; period table; associations; see Assumptions.';\n    el.appendChild(note);\n  }\n\n  function h(tag,attrs){ const e=document.createElementNS('http://www.w3.org/2000/svg',tag); for(const k in attrs) e.setAttribute(k,attrs[k]); return e; }\n  function line(x1,y1,x2,y2,stroke){ const l=h('line',{x1,y1,x2,y2,stroke}); svg.appendChild(l); }\n  function text(x,y,str,anchor='start',baseline='hanging',size='0.8em'){ const t=h('text',{x,y,'text-anchor':anchor,'dominant-baseline':baseline,'font-size':size,fill:'#444'}); t.textContent=str; svg.appendChild(t); }\n}\n// Convert per-1000 LYG/QALY to per-person delta; gate by age windows; include an effectiveness factor.\nfunction screeningYearsGain(age, sex, flags, data){\n  let le=0, qaly=0;\n  const eff = 0.8; // conservative real-world adherence/effectiveness\n  if (flags?.crc && age>=45 && age<=75 && data?.screening_crc){\n    le  += (data.screening_crc.LYG_per_1000||260)/1000 * eff;\n    qaly+= (data.screening_crc.QALY_per_1000||210)/1000 * eff;\n  }\n  if (flags?.breast && sex==='F' && age>=40 && age<=74 && data?.screening_breast){\n    le  += (data.screening_breast.LYG_per_1000||60)/1000 * eff;\n    qaly+= (data.screening_breast.QALY_per_1000||45)/1000 * eff;\n  }\n  return {le, qaly};\n}\n// Methodology descriptions for various variables\n\nconst methodologyInfo = {\n  smoking: `\n    <h3>Smoking</h3>\n    <p><strong>Source:</strong> Jha et al., 2013</p>\n    <p><strong>Implementation:</strong> js/hrModels.js</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Current smokers have about 2.8× the mortality of never smokers; quitting for ∼20 years returns risk to baseline.</p>\n    <p><strong>Mitigation:</strong> Quit smoking and avoid secondhand exposure.</p>\n    <p><strong>Population:</strong> About 9.9% of U.S. adults smoke (CDC).</p>\n  `,\n  physical_activity: `\n    <h3>Physical Activity</h3>\n    <p><strong>Source:</strong> Arem et al., 2015</p>\n    <p><strong>Implementation:</strong> js/hrModels.js</p>\n    <p><strong>Hazard-Ratio Effect:</strong> ≥60 MET‑h/week corresponds to HR≈0.53 (47% lower mortality) versus inactivity.</p>\n    <p><strong>Mitigation:</strong> Engage in regular moderate or vigorous exercise.</p>\n    <p><strong>Population:</strong> Only 24.2% meet both aerobic and strength guidelines (CDC).</p>\n  `,\n  bmi: `\n    <h3>BMI</h3>\n    <p><strong>Source:</strong> Global BMI Mortality Collaboration, 2016</p>\n    <p><strong>Implementation:</strong> js/hrModels.js</p>\n    <p><strong>Hazard-Ratio Effect:</strong> BMI 35–39.9 carries HR≈1.94; BMI≥40 reaches HR≈2.76; underweight HR≈1.22 vs BMI 22.5–&lt;25.</p>\n    <p><strong>Mitigation:</strong> Maintain a healthy weight through balanced diet and activity.</p>\n    <p><strong>Population:</strong> About 40.3% of adults have obesity (CDC).</p>\n  `,\n  alcohol: `\n    <h3>Alcohol</h3>\n    <p><strong>Source:</strong> Wood et al., 2018</p>\n    <p><strong>Implementation:</strong> js/hrModels.js</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Mortality risk rises to HR≈1.40 at six drinks/day; no protective effect assumed.</p>\n    <p><strong>Mitigation:</strong> Limit intake or abstain.</p>\n    <p><strong>Population:</strong> About 25.1% report at least one heavy drinking day in the past year (CDC).</p>\n  `,\n  diet: `\n    <h3>Diet</h3>\n    <p><strong>Source:</strong> Not yet modeled.</p>\n    <p><strong>Implementation:</strong> pending</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Diet quality influences cardiovascular and overall mortality.</p>\n    <p><strong>Mitigation:</strong> Emphasize fruits, vegetables, whole grains, and minimal processed foods.</p>\n    <p><strong>Population:</strong> Only about 10% meet fruit and vegetable recommendations.</p>\n  `,\n  blood_pressure_cholesterol: `\n    <h3>Blood Pressure / Cholesterol</h3>\n    <p><strong>Source:</strong> Not yet modeled.</p>\n    <p><strong>Implementation:</strong> pending</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Hypertension and high LDL elevate cardiovascular mortality.</p>\n    <p><strong>Mitigation:</strong> Control levels with medication and lifestyle.</p>\n    <p><strong>Population:</strong> Nearly half of U.S. adults have hypertension.</p>\n  `,\n  diabetes: `\n    <h3>Diabetes</h3>\n    <p><strong>Source:</strong> Not yet modeled.</p>\n    <p><strong>Implementation:</strong> pending</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Diabetes roughly doubles mortality risk.</p>\n    <p><strong>Mitigation:</strong> Maintain glycemic control via diet, exercise, and medication.</p>\n    <p><strong>Population:</strong> About 11% of U.S. adults have diabetes.</p>\n  `,\n  sleep: `\n    <h3>Sleep</h3>\n    <p><strong>Source:</strong> Not yet modeled.</p>\n    <p><strong>Implementation:</strong> pending</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Very short or long sleep durations are linked to higher mortality.</p>\n    <p><strong>Mitigation:</strong> Aim for 7–9 hours of quality sleep nightly.</p>\n    <p><strong>Population:</strong> About 35% of adults sleep less than 7 hours.</p>\n  `,\n  socioeconomic_status: `\n    <h3>Socioeconomic Status</h3>\n    <p><strong>Source:</strong> Not yet modeled.</p>\n    <p><strong>Implementation:</strong> pending</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Lower SES is associated with higher mortality risk.</p>\n    <p><strong>Mitigation:</strong> Social support and policy interventions may reduce risk.</p>\n    <p><strong>Population:</strong> Roughly 11% of Americans live in poverty.</p>\n  `,\n  colorectal_screening: `\n    <h3>Colorectal Screening</h3>\n    <p><strong>Source:</strong> Knudsen et al., 2021</p>\n    <p><strong>Implementation:</strong> js/screening.js</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Modeled as life-years gained from screening participation.</p>\n    <p><strong>Mitigation:</strong> Follow USPSTF screening guidelines.</p>\n  `,\n  breast_screening: `\n    <h3>Breast Screening</h3>\n    <p><strong>Source:</strong> USPSTF, 2016</p>\n    <p><strong>Implementation:</strong> js/screening.js</p>\n    <p><strong>Hazard-Ratio Effect:</strong> Modeled as life-years gained from routine mammography.</p>\n    <p><strong>Mitigation:</strong> Participate in recommended screening intervals.</p>\n    <p><strong>Population:</strong> 69.1% of women ≥40 had a mammogram within 2 years (CDC).</p>\n  `\n};\n\nfunction loadMethodology() {\n  const select = document.getElementById('methodology-select');\n  const content = document.getElementById('methodology-content');\n  if (!select || !content) return;\n  select.addEventListener('change', (e) => {\n    const key = e.target.value;\n    content.innerHTML = methodologyInfo[key] || '';\n  });\n}\n\n// Generic UI niceties: show/hide yearsSinceQuit, focus management, etc.\n\n(function(){\n  function closeTips(){\n    document.querySelectorAll('.info-btn[data-open]').forEach(btn => btn.removeAttribute('data-open'));\n  }\n\n  document.addEventListener('change', e=>{\n    if (e.target?.id==='smoking'){\n      document.getElementById('ysq-wrap').hidden = (e.target.value!=='former');\n    }\n  });\n\n  // initialize visibility on load based on saved state\n  window.addEventListener('DOMContentLoaded', ()=>{\n    const s = getState();\n    document.getElementById('ysq-wrap').hidden = (s.smoking!=='former');\n\n    // fun facts\n    const facts = [\n      'Regular exercise can add years to your life expectancy.',\n      'Smoking can cut life expectancy by up to a decade.',\n      'Healthy diets are linked to longer lifespans.'\n    ];\n    const ff = document.getElementById('fun-fact');\n    const shuffle = document.getElementById('shuffle-fact');\n    if (ff && facts.length) {\n      let idx = Math.floor(Math.random() * facts.length);\n      ff.textContent = facts[idx];\n      if (shuffle) {\n        shuffle.addEventListener('click', () => {\n          idx = (idx + 1) % facts.length;\n          ff.textContent = facts[idx];\n        });\n      }\n    } else if (ff) {\n      ff.textContent = 'No facts yet.';\n      if (shuffle) shuffle.disabled = true;\n    }\n\n    // simple tool picker tabs\n    const buttons = document.querySelectorAll('[data-tool]');\n    if (buttons.length) {\n      const show = val => {\n        document.querySelectorAll('section.tool').forEach(sec => sec.hidden = true);\n        const el = document.getElementById(val);\n        if (el) el.hidden = false;\n        buttons.forEach(btn => {\n          const active = btn.getAttribute('data-tool') === val;\n          btn.classList.toggle('bg-slate-900', active);\n          btn.classList.toggle('text-white', active);\n          btn.classList.toggle('bg-white', !active);\n          btn.classList.toggle('hover:bg-slate-50', !active);\n        });\n      };\n      buttons.forEach(btn => btn.addEventListener('click', () => show(btn.getAttribute('data-tool'))));\n      show(buttons[0].getAttribute('data-tool'));\n    }\n\n    // info tooltip toggling\n    const infos = document.querySelectorAll('.info-btn');\n    infos.forEach(btn => {\n      const tip = btn.querySelector('.info-tip');\n      if(!tip) return;\n      btn.addEventListener('click', ev => {\n        ev.stopPropagation();\n        const isOpen = btn.hasAttribute('data-open');\n        closeTips();\n        if(!isOpen){\n          const rect = btn.getBoundingClientRect();\n          const center = window.innerWidth / 2;\n          tip.classList.toggle('right', rect.left < center);\n          tip.classList.toggle('left', rect.left >= center);\n          btn.setAttribute('data-open','');\n        }\n      });\n    });\n\n    document.addEventListener('click', closeTips);\n    document.addEventListener('keydown', e => { if(e.key==='Escape') closeTips(); });\n    window.addEventListener('resize', closeTips);\n\n    // collapsible disclaimers and notes\n    document.querySelectorAll('[data-toggle]').forEach(btn=>{\n      const target = document.getElementById(btn.getAttribute('data-toggle'));\n      if(!target) return;\n      btn.addEventListener('click', ()=>{\n        const expanded = btn.getAttribute('aria-expanded') === 'true';\n        btn.setAttribute('aria-expanded', String(!expanded));\n        target.hidden = expanded;\n      });\n    });\n  });\n})();\nconst workerSrc = `\n// Heavy math: life table transform, proportional hazards, Sullivan HALE, attribution.\n// DISCLAIMER: This model uses period life tables and literature HRs; it is simplified and does not capture interactions.\n// Not medical advice. Results are sensitive to assumptions.\n\n// importScripts; // no-op hint for bundlers (kept for bundlers, safe if undefined)\n\nlet life, hrAct, hrBmi, hrSmoke, hrAlc, haleWeights, screening_crc, screening_breast;\nconst ctx = typeof self !== 'undefined' ? self : globalThis;\n\nctx.onmessage = (e)=>{\n  const {cmd, payload} = e.data;\n  if (cmd==='init'){\n    // Datasets are passed in as blobs from dataLoader\n    const d = payload||{};\n    life = d['lifetable_US_2022'] || {};\n    hrAct= d['hr_physical_activity'] || null;\n    hrBmi= d['hr_bmi'] || null;\n    hrSmoke=d['hr_smoking'] || null;\n    hrAlc= d['hr_alcohol'] || null;\n    haleWeights = d['hale_weights'] || null;\n    screening_crc = d['screening_crc'] || null;\n    screening_breast = d['screening_breast'] || null;\n    ctx.postMessage({ready:true});\n    return;\n  }\n  if (cmd==='run'){\n    ctx.postMessage(runModel(payload));\n  }\n};\n\nfunction runModel(st){\n  const ages = range(0,111);\n  // Life table qx for sex; fall back to synthetic Gompertz if missing.\n  const qxRaw = life?.[st.sex]?.qx || syntheticQx(st.sex);\n  const qx = fillQxGaps(qxRaw);\n  const muBase = ages.map(a => -Math.log(1 - qx[a]));\n  // HRs (age-invariant scalars in this MVP)\n  const HR = hrSmoking(st.smoking) * hrActivity(st.metHours, hrAct) * hrBmiFn(st.bmi, hrBmi) * hrAlcohol(st.alcoholDrinks, hrAlc);\n\n  const qxAdj = muBase.map(m => 1 - Math.exp(-(m*HR)));\n  const base = lifeTableFromQx(qx);\n  const adj  = lifeTableFromQx(indexify(qxAdj));\n\n  let le_delta = +(adj.e[st.age]-base.e[st.age]).toFixed(2);\n\n  // HALE via Sullivan (if weights present)\n  let hale_base=null, hale_adj=null, hale_delta=null;\n  if (haleWeights?.[st.sex]){\n    const Hb = haleFromLife(base, haleWeights[st.sex]);\n    const Ha = haleFromLife(adj,  haleWeights[st.sex]);\n    hale_base = +Hb[st.age].toFixed(2);\n    hale_adj  = +Ha[st.age].toFixed(2);\n    hale_delta= +(hale_adj - hale_base).toFixed(2);\n  }\n\n  // Screening additive deltas\n  const scr = screeningYearsGain(st.age, st.sex, st.screening);\n  const le_adj_final   = +(adj.e[st.age] + scr.le).toFixed(2);\n  const le_delta_final = +(le_delta + scr.le).toFixed(2);\n  const hale_adj_final = (hale_adj!=null && scr.qaly!=null) ? +(hale_adj + scr.qaly).toFixed(2) : hale_adj;\n  const hale_delta_fin = (hale_delta!=null && scr.qaly!=null) ? +(hale_delta + scr.qaly).toFixed(2) : hale_delta;\n\n  return {\n    le_baseline: +base.e[st.age].toFixed(2),\n    le_adj: le_adj_final, le_delta: le_delta_final,\n    hale_baseline: hale_base, hale_adj: hale_adj_final, hale_delta: hale_delta_fin,\n    survival: { age: ages, S_base: base.S, S_adj: adj.S },\n    contrib: contributionBreakdown(st, muBase, qx, base)\n  };\n}\n\n// --- HR helpers (duplicate of hrModels, kept local to worker) ---\nfunction hrSmoking(sm){ // sm = {status, yearsSinceQuit}\n  if (sm.status==='never') return 1.0;\n  if (sm.status==='current') return (hrSmoke?.current||2.8);\n  const decay = hrSmoke?.former_decay || [{years:0,HR:2.0},{years:5,HR:1.5},{years:10,HR:1.2},{years:15,HR:1.05},{years:20,HR:1.0}];\n  const t = Math.max(0, sm.yearsSinceQuit||0);\n  let prev=decay[0]; for(let i=1;i<decay.length;i++){\n    const cur=decay[i]; if(t<=cur.years){\n      const w=(t-prev.years)/(cur.years-prev.years);\n      return prev.HR + w*(cur.HR-prev.HR);\n    } prev=cur;\n  }\n  return decay[decay.length-1].HR;\n}\nfunction hrActivity(met, table){\n  const bins = table?.bins_MET_h_week || [0,7.5,15,22.5,37.5,60,90];\n  const HRs  = table?.HR || [1.00,0.81,0.69,0.61,0.55,0.53,0.53];\n  return interpBins(met,bins,HRs);\n}\nfunction hrBmiFn(bmi, table){\n  const bins = table?.bins_BMI || [0,18.5,22.5,25,27.5,30,35,40,70];\n  const HRs  = table?.HR || [1.22,1.00,1.00,1.07,1.20,1.45,1.94,2.76];\n  return interpBins(bmi,bins,HRs);\n}\nfunction hrAlcohol(drinks, table){\n  const pts = table?.dose_HR || [{drinksPerDay:0,HR:1.00},{drinksPerDay:1,HR:1.03},{drinksPerDay:2,HR:1.06},{drinksPerDay:3,HR:1.12},{drinksPerDay:4,HR:1.20},{drinksPerDay:6,HR:1.40}];\n  if (drinks<=pts[0].drinksPerDay) return pts[0].HR;\n  for (let i=1;i<pts.length;i++){\n    const a=pts[i-1], b=pts[i];\n    if (drinks<=b.drinksPerDay){\n      const w=(drinks-a.drinksPerDay)/(b.drinksPerDay-a.drinksPerDay);\n      return a.HR + w*(b.HR-a.HR);\n    }\n  }\n  const a=pts[pts.length-2], b=pts[pts.length-1];\n  const slope=(b.HR-a.HR)/(b.drinksPerDay-a.drinksPerDay);\n  return b.HR + slope*(drinks-b.drinksPerDay);\n}\nfunction interpBins(x,bins,vals){\n  if (x<=bins[0]) return vals[0];\n  for (let i=1;i<bins.length;i++){\n    if (x<=bins[i]){\n      const w=(x-bins[i-1])/(bins[i]-bins[i-1]);\n      return vals[i-1] + w*(vals[i]-vals[i-1]);\n    }\n  }\n  return vals[vals.length-1];\n}\n\n// --- Screening additive deltas (simple, per-person) ---\nfunction screeningYearsGain(age, sex, flags){\n  const eff=0.8;\n  let le=0, qaly=0;\n  if (flags?.crc && age>=45 && age<=75 && screening_crc){\n    le  += (screening_crc.LYG_per_1000||260)/1000 * eff;\n    qaly+= (screening_crc.QALY_per_1000||210)/1000 * eff;\n  }\n  if (flags?.breast && sex==='F' && age>=40 && age<=74 && screening_breast){\n    le  += (screening_breast.LYG_per_1000||60)/1000 * eff;\n    qaly+= (screening_breast.QALY_per_1000||45)/1000 * eff;\n  }\n  return {le,qaly};\n}\n\n// --- Life table math ---\nfunction fillQxGaps(qx){\n  const out = {};\n  let last = qx[0] ?? 0;\n  for(let a=0;a<=110;a++){\n    if(qx[a]!=null) last = qx[a];\n    out[a] = last;\n  }\n  return out;\n}\n\nfunction lifeTableFromQx(qx){\n  const ages = Object.keys(qx).map(k=>+k).sort((a,b)=>a-b);\n  const maxA = ages[ages.length-1];\n  const l = new Array(maxA+1); const L = new Array(maxA+1); const T = new Array(maxA+1); const e = new Array(maxA+1); const S = new Array(maxA+1);\n  let l0=100000; l[0]=l0;\n  for(let a=0;a<maxA;a++){\n    const qa = qx[a] ?? qx[maxA];\n    l[a+1] = l[a]*(1-qa);\n    L[a]   = (l[a]+l[a+1])/2;\n  }\n  L[maxA] = l[maxA]; // last age interval\n  T[maxA] = L[maxA];\n  for(let a=maxA-1;a>=0;a--) T[a] = L[a] + T[a+1];\n  for(let a=0;a<=maxA;a++){ e[a] = T[a]/l[a]; S[a] = l[a]/l0; }\n  return { l,L,T,e,S };\n}\n\nfunction haleFromLife(life, weights){ // weights[age] in [0,1]\n  const maxA = life.L.length-1;\n  const Lh = new Array(maxA+1);\n  for(let a=0;a<=maxA;a++){\n    const w = weights[a] ?? weights[maxA] ?? 0.7;\n    Lh[a] = life.L[a]*w;\n  }\n  const Th = new Array(maxA+1); Th[maxA]=Lh[maxA];\n  for(let a=maxA-1;a>=0;a--) Th[a]=Lh[a]+Th[a+1];\n  const Eh = new Array(maxA+1);\n  for(let a=0;a<=maxA;a++) Eh[a]=Th[a]/life.l[a];\n  return Eh;\n}\n\nfunction syntheticQx(sex){\n  // Gompertz-Makeham-ish fallback to avoid hard failure if dataset missing. Tuned to resemble US 2022.\n  const qx={};\n  for(let a=0;a<=110;a++){\n    const makeham = 0.0005;\n    const b = 0.085 + (sex==='M'?0.005:0);\n    const c = 0.00002;\n    const mu = makeham + c*Math.exp(b*Math.max(0,a-30));\n    qx[a] = 1 - Math.exp(-mu);\n  }\n  qx[110]=1.0;\n  return qx;\n}\n\nfunction range(a,b){ return Array.from({length:b-a},(_,i)=>a+i); }\nfunction indexify(arr){ const out={}; for (let i=0;i<arr.length;i++) out[i]=arr[i]; return out; }\nfunction clamp(x,a,b){ return Math.min(b,Math.max(a,x)); }\n\n// Attribution: simple “turn one factor on” deltas vs baseline. Order-dependent; explanatory only.\nfunction contributionBreakdown(st, muBase, qx, base){\n  const parts = [];\n  const factors = [\n    {key:'smoking',  label:'Smoking',  HR: hrSmoking(st.smoking)},\n    {key:'activity', label:'Physical activity', HR: hrActivity(st.metHours, hrAct)},\n    {key:'bmi',      label:'BMI', HR: hrBmiFn(st.bmi, hrBmi)},\n    {key:'alcohol',  label:'Alcohol', HR: hrAlcohol(st.alcoholDrinks, hrAlc)}\n  ];\n  for (const f of factors){\n    const qxOne = muBase.map(m => 1 - Math.exp(-(m*f.HR)));\n    const lt = lifeTableFromQx(indexify(qxOne));\n    parts.push({label:f.label, deltaYears: +(lt.e[st.age]-base.e[st.age]).toFixed(2)});\n  }\n  return parts;\n}\n\n`;\n// Bootstrap, state wiring, worker orchestration, charts, CSV/share, disclaimers.\n\nlet worker;\nlet currentAge = 0;\n\nasync function init() {\n  const data = await loadAllData();\n  // Create worker and pass datasets\n  worker = new Worker(URL.createObjectURL(new Blob([workerSrc], {type:'application/javascript'})));\n  worker.onmessage = onWorkerMessage;\n  worker.postMessage({ cmd:'init', payload: data });\n\n  initStateFromURL();\n  wireUI();\n  loadMethodology();\n  run(); // initial run\n}\ndocument.addEventListener('DOMContentLoaded', init);\n\nfunction wireUI() {\n  const s = getState();\n\n  // Inputs\n  bindNumber('age', v => update({ age: clamp(+v,20,100) }));\n  bindSelect('sex', v => update({ sex: v }));\n  bindSelect('smoking', v => {\n    document.getElementById('ysq-wrap').hidden = (v !== 'former');\n    update({ smoking: v });\n  });\n  bindNumber('yearsSinceQuit', v => update({ yearsSinceQuit: Math.max(0, +v||0) }));\n\n  const activityMap = { none:0, light:5, moderate:10, high:20 };\n  const actEl = document.getElementById('activityLevel');\n  const met = s.metHours ?? 10;\n  actEl.value = met>=20 ? 'high' : met>=10 ? 'moderate' : met>=5 ? 'light' : 'none';\n  actEl.addEventListener('change', ev => update({ metHours: activityMap[ev.target.value] }));\n\n  bindNumber('weight', v => update({ weight: Math.max(50, +v||50) }), 'weight');\n  bindNumber('heightFeet', v => update({ heightFt: Math.max(3, +v||3) }), 'heightFt');\n  bindNumber('heightInches', v => update({ heightIn: Math.max(0, Math.min(11, +v||0)) }), 'heightIn');\n  bindSelect('alcohol', v => update({ alcoholDrinks: Math.max(0, +v||0) }), 'alcoholDrinks');\n\n  const crcEl = document.getElementById('crc_screen');\n  crcEl.value = s.crc ? 'yes' : 'no';\n  crcEl.addEventListener('change', e => update({ crc: e.target.value === 'yes' }));\n  const breastEl = document.getElementById('breast_screen');\n  breastEl.value = s.breast ? 'yes' : 'no';\n  breastEl.addEventListener('change', e => update({ breast: e.target.value === 'yes' }));\n  document.getElementById('qualityToggle').addEventListener('change', e => update({ quality: e.target.checked }));\n  document.getElementById('runBtn').addEventListener('click', run);\n\n  // Modal\n  const dlg = document.getElementById('assumptionsModal');\n  document.getElementById('assumptionsBtn').addEventListener('click', ()=> dlg.showModal());\n  document.getElementById('closeAssumptions').addEventListener('click', ()=> dlg.close());\n\n  // Export\n  document.getElementById('downloadCsv').addEventListener('click', downloadCsv);\n\n  // react to state changes\n  onStateChange(() => {\n    saveToLocal();\n    updateScreeningVisibility();\n    // optional auto-run on blur; explicit button kept for mobile\n  });\n\n  updateScreeningVisibility();\n\n  // Helpers to bind inputs\n  function bindNumber(id, fn, key=id){ const e=document.getElementById(id); e.value = s[key] ?? e.value; e.addEventListener('change', ev=>fn(ev.target.value)); }\n  function bindSelect(id, fn, key=id){ const e=document.getElementById(id); e.value = s[key] ?? e.value; e.addEventListener('change', ev=>fn(ev.target.value)); }\n  function update(p){ setState(p); }\n  function clamp(x,a,b){ return Math.min(b,Math.max(a,x)); }\n\n  function updateScreeningVisibility(){\n    const { age, sex } = getState();\n    const crcWrap = document.getElementById('crc_wrap');\n    const breastWrap = document.getElementById('breast_wrap');\n    const fs = document.getElementById('screening_fs');\n    const showCRC = age>=45 && age<=75;\n    const showBreast = sex==='F' && age>=40 && age<=74;\n    crcWrap.hidden = !showCRC;\n    breastWrap.hidden = !showBreast;\n    if(!showCRC && getState().crc){ crcEl.value='no'; setState({crc:false}); }\n    if(!showBreast && getState().breast){ breastEl.value='no'; setState({breast:false}); }\n    fs.hidden = !showCRC && !showBreast;\n  }\n}\n\nfunction run() {\n  const st = getStateForWorker();\n  currentAge = +st.age;\n  worker.postMessage({ cmd:'run', payload: st });\n}\n\nfunction onWorkerMessage(e) {\n  const msg = e.data;\n  if (msg.ready) return;\n  // update summary numbers\n  q('#le_baseline').textContent = fix2(currentAge + msg.le_baseline);\n  q('#le_adjusted').textContent = fix2(currentAge + msg.le_adj);\n  q('#le_delta').textContent    = addSign(fix2(msg.le_delta));\n\n  if (msg.hale_baseline != null) {\n    q('#hale_baseline').textContent = fix2(currentAge + msg.hale_baseline);\n    q('#hale_adjusted').textContent = fix2(currentAge + msg.hale_adj);\n    q('#hale_delta').textContent    = addSign(fix2(msg.hale_delta));\n    document.getElementById('hale-row').hidden = false;\n  } else {\n    document.getElementById('hale-row').hidden = true;\n  }\n\n  // contribution chips\n  const c = document.getElementById('contrib'); c.innerHTML = '';\n  (msg.contrib||[]).forEach(it=>{\n    const span = document.createElement('span');\n    span.className='chip';\n    span.textContent = `${it.label}: ${addSign(fix2(it.deltaYears))}y`;\n    c.appendChild(span);\n  });\n\n  // charts (conditional on current age)\n  const idx = msg.survival.age.findIndex(a => a >= currentAge);\n  const ages = msg.survival.age.slice(idx);\n  const baseCond = msg.survival.S_base.slice(idx).map(v => v / msg.survival.S_base[idx]);\n  const adjCond  = msg.survival.S_adj.slice(idx).map(v => v / msg.survival.S_adj[idx]);\n\n  drawLines('survivalChart', [\n    { name:'Baseline', x: ages, y: baseCond },\n    { name:'Adjusted', x: ages, y: adjCond }\n  ], { title:'Survival', xLabel:'Age', yPercent:true, disclaimer:true });\n\n  const oneMinusS  = baseCond.map(v=>1-v);\n  const oneMinusSa = adjCond.map(v=>1-v);\n  drawLines('cdfChart', [\n    { name:'Baseline', x: ages, y: oneMinusS },\n    { name:'Adjusted', x: ages, y: oneMinusSa }\n  ], { title:'Cumulative probability of death', xLabel:'Age', yPercent:true, disclaimer:true });\n}\n\nfunction getStateForWorker(){\n  const s = getState();\n  const hInches = (+s.heightFt||0)*12 + (+s.heightIn||0);\n  const bmi = hInches>0 ? 703*(+s.weight||0)/(hInches*hInches) : 27.5;\n  return {\n    sex: s.sex,\n    age: +s.age || 35,\n    smoking: { status: s.smoking, yearsSinceQuit: s.yearsSinceQuit||0 },\n    metHours: (s.metHours ?? 10),\n    bmi: bmi,\n    alcoholDrinks: +s.alcoholDrinks || 0,\n    screening: { crc: !!s.crc, breast: !!s.breast },\n    quality: !!s.quality\n  };\n}\n\nfunction downloadCsv(){\n  const s = getState();\n  // We ask worker to recompute to get fresh arrays; but we already have them in last message.\n  // For simplicity, reuse last plotted data by reading DOM dataset if you store it; here we re-run.\n  worker.onmessage = (e)=>{\n    if (e.data.ready) return;\n    const m = e.data;\n    const header = [\n      'DISCLAIMER: Population-level, period life table, proportional hazards; not medical advice.',\n      'See site UI for full “Assumptions & Data Sources.”',\n      `Inputs: sex=${s.sex}, age=${s.age}, weight=${s.weight}lbs, height=${s.heightFt}ft${s.heightIn}in (BMI=${fix2(calcBMI(s))}), smoke=${s.smoking}${s.smoking==='former'?`(${s.yearsSinceQuit}y)`:''}, MET=${s.metHours ?? 10}, alcohol=${s.alcoholDrinks}, CRC=${!!s.crc}, Breast=${!!s.breast}, Quality=${!!s.quality}`,\n      `LE baseline=${fix2(m.le_baseline)}; LE adjusted=${fix2(m.le_adj)}; Δ=${addSign(fix2(m.le_delta))}`,\n      (m.hale_baseline!=null?`HALE baseline=${fix2(m.hale_baseline)}; HALE adjusted=${fix2(m.hale_adj)}; Δ=${addSign(fix2(m.hale_delta))}`:''),\n      'age,S_baseline,S_adjusted'\n    ].filter(Boolean).join('\\n');\n    const rows = m.survival.age.map((a,i)=>`${a},${m.survival.S_base[i]},${m.survival.S_adj[i]}`).join('\\n');\n    const blob = new Blob([header+'\\n'+rows], {type:'text/csv'});\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a'); a.href=url; a.download='longevity_lab.csv'; a.click();\n    URL.revokeObjectURL(url);\n    // restore handler\n    worker.onmessage = onWorkerMessage;\n  };\n  run();\n}\n\nfunction q(sel){ return document.querySelector(sel); }\nfunction fix2(x){ return Number(x).toFixed(2); }\nfunction addSign(x){ return (x>=0?'+':'')+x; }\nfunction calcBMI(s){ const h=(+s.heightFt||0)*12+(+s.heightIn||0); return h>0 ? 703*(+s.weight||0)/(h*h) : 0; }\n"
    },
    {
      "path": "style.css",
      "hash": "0431d34d1117ee9be8e40a206023988125a60771948267a40c5bbfcbca4ee1ee",
      "content": "/* Base polish */\n:root{\n  --ring: 0 0 0 3px rgba(59, 130, 246, .35);\n  --ease-out: cubic-bezier(.2,.8,.2,1);\n  --ease-in: cubic-bezier(.4,0,1,1);\n}\n\n*,\n*::before,\n*::after { box-sizing: border-box; }\n\nhtml, body { height: 100%; }\nbody {\n  font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, \"Helvetica Neue\", Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n  text-rendering: optimizeLegibility;\n}\n\n/* Card container used by <Section> */\n.card {\n  background: white;\n  backdrop-filter: none;\n  border: 1px solid rgba(15, 23, 42, .08);\n  border-radius: 16px;\n  box-shadow: 0 4px 14px rgba(2, 6, 23, .04);\n  animation: fadeUp .35s var(--ease-out) both;\n}\n\n/* Inputs / selects */\n.field{\n  width: 100%;\n  appearance: none;\n  background: white;\n  border: 1px solid rgba(15,23,42,.12);\n  border-radius: 12px;\n  padding: .55rem .75rem;\n  font-size: 0.95rem;\n  line-height: 1.15rem;\n  transition: border-color .2s var(--ease-out), box-shadow .2s var(--ease-out), transform .06s var(--ease-out);\n}\n.field:focus{\n  outline: none;\n  border-color: rgb(99, 102, 241);\n  box-shadow: var(--ring);\n}\n.field:active{ transform: translateY(0.5px); }\n\n/* Tiny keyboard style button (Reset) */\n.kbd{\n  background: white;\n  border: 1px solid rgba(15,23,42,.12);\n  padding: .25rem .5rem;\n  border-radius: .5rem;\n  font-size: .8rem;\n  line-height: 1rem;\n  box-shadow: inset 0 -1px rgba(0,0,0,.03);\n  transition: transform .07s var(--ease-out), box-shadow .2s var(--ease-out);\n}\n.kbd:hover{ box-shadow: 0 6px 18px rgba(2,6,23,.08); }\n.kbd:active{ transform: translateY(1px) scale(.99); }\n\n/* Icon button + ripple */\n.icon-btn{\n  width: 28px; height: 28px;\n  display: inline-flex; align-items: center; justify-content: center;\n  border-radius: 50%;\n  border: 1px solid rgba(15,23,42,.08);\n  background: white;\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 1px 0 rgba(2,6,23,.04);\n  transition: transform .08s var(--ease-out), box-shadow .2s var(--ease-out);\n}\n.icon-btn:hover{ box-shadow: 0 6px 18px rgba(2,6,23,.08); }\n.icon-btn:active{ transform: translateY(1px) scale(.98); }\n.icon-btn::after{\n  content:''; position:absolute; inset:0; border-radius:inherit;\n  background: radial-gradient(circle at center, rgba(15,23,42,.08), transparent 55%);\n  opacity:0; transform: scale(0);\n  transition: transform .25s var(--ease-out), opacity .25s var(--ease-out);\n}\n.icon-btn:active::after{ opacity:1; transform: scale(1.4); }\n\n/* Info button tooltips */\n.info-btn{ position: relative; }\n.info-btn .info-tip{\n  display: none;\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  min-width: 200px;\n  max-width: 280px;\n  background: white;\n  border: 1px solid rgba(15,23,42,.12);\n  padding: .6rem .7rem;\n  border-radius: .6rem;\n  box-shadow: 0 18px 40px rgba(2,6,23,.12);\n  z-index: 40;\n}\n.info-btn[data-open] .info-tip{ display: block; }\n.info-tip.left{ right: calc(100% + 8px); }\n.info-tip.right{ left: calc(100% + 8px); }\n.info-tip::before{\n  content:'';\n  position:absolute;\n  top:50%;\n  width:12px; height:12px;\n  background:inherit;\n  border:1px solid rgba(15,23,42,.12);\n  transform:translateY(-50%) rotate(45deg);\n}\n.info-tip.left::before{\n  right:-6px;\n  border-left:none;\n  border-bottom:none;\n}\n.info-tip.right::before{\n  left:-6px;\n  border-right:none;\n  border-top:none;\n}\n\n/* Shimmer / skeleton (fallback if Tailwind animate-pulse not present) */\n.animate-pulse:not(.tw){ /* keep if Tailwind is missing */\n  background: linear-gradient(90deg, #e5e7eb 25%, #f3f4f6 37%, #e5e7eb 63%);\n  background-size: 400% 100%;\n  animation: shimmer 1.4s ease infinite;\n  border-radius: .5rem;\n  height: 1rem;\n}\n@keyframes shimmer{\n  0%{ background-position: -400px 0; }\n  100%{ background-position: 400px 0; }\n}\n\n/* Subtle float/tilt on cards (makes the page feel “alive”) */\n.card:hover{\n  transform: translateY(-1px);\n  box-shadow: 0 12px 32px rgba(2,6,23,.08);\n  transition: box-shadow .2s var(--ease-out), transform .2s var(--ease-out);\n}\n\n/* Badge chips */\n.badge{\n  display:inline-flex; align-items:center; gap:.35rem;\n  padding: .2rem .5rem;\n  border-radius: 999px;\n  background: white;\n  border: 1px solid rgba(15,23,42,.1);\n}\n\n/* Mono number readouts (kcal etc.) */\n.mono{ font-variant-numeric: tabular-nums; font-feature-settings: \"tnum\" 1; }\n\n/* Small page-level enter animation for main sections */\nsection.card { animation: fadeUp .42s var(--ease-out) both; }\n@keyframes fadeUp{\n  0% { opacity:0; transform: translateY(10px) scale(.985); }\n  100% { opacity:1; transform: translateY(0) scale(1); }\n}\n\n/* Accessibility: reduce motion */\n@media (prefers-reduced-motion: reduce){\n  .card,\n  .animate-pulse,\n  .icon-btn::after,\n  .info-btn .info-tip{\n    animation: none !important;\n    transition: none !important;\n  }\n}\n\n/* Tiny helpers for smoother links/buttons focus */\na, button, select, input {\n  -webkit-tap-highlight-color: transparent;\n}\na:focus-visible,\nbutton:focus-visible,\nselect:focus-visible,\ninput:focus-visible{\n  outline: none;\n  box-shadow: var(--ring);\n  border-color: rgb(99, 102, 241);\n}\n\n/* Optional: tab buttons feel more “pressable” */\nbutton[type=\"button\"], .card button, .card .kbd {\n  transition: transform .06s var(--ease-out), box-shadow .2s var(--ease-out);\n}\nbutton[type=\"button\"]:active { transform: translateY(1px); }\n\n/* --- Bouncy profile icon --- */\n@keyframes bobble {\n  0%, 100% { transform: translateY(0) rotate(0deg); }\n  50%      { transform: translateY(-6px) rotate(0.5deg); }\n}\n.bouncy {\n  animation: bobble 1200ms cubic-bezier(.28,.84,.42,1) infinite;\n  will-change: transform;\n}\n.bouncy:hover { animation-duration: 900ms; }\n\n/* --- Smooth content reveal for Info panel --- */\n@keyframes fadeSlide {\n  from { opacity: 0; transform: translateY(6px); }\n  to   { opacity: 1; transform: translateY(0); }\n}\n.fade-slide-in {\n  animation: fadeSlide 220ms cubic-bezier(.2,.7,.2,1);\n}\n\n/* Layout helpers */\n.subtabs{\n  display:flex;\n  flex-wrap:wrap;\n  gap:.5rem;\n}\n\n[hidden]{\n  display:none !important;\n}\n\n.card-grid{\n  display:grid;\n  gap:1rem;\n  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));\n}\n\n.editor{\n  background:white;\n  border:1px solid rgba(15,23,42,.12);\n  border-radius:12px;\n  padding:1rem;\n}\n\n/* Overrides and additional program-specific styles */\n\n/* Ensure touch targets */\n.field{ min-height:44px; }\nselect, input[type=\"checkbox\"]{ min-height:44px; }\ninput[type=\"checkbox\"]{ min-width:44px; }\n\n#qualityToggle{\n  min-width:16px;\n  min-height:16px;\n  width:16px;\n  height:16px;\n}\n\n/* Primary and secondary buttons */\n.primary,\n.secondary {\n  padding: .6rem 1.1rem;\n  border-radius: 12px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: background-color .2s var(--ease-out), box-shadow .2s var(--ease-out), transform .06s var(--ease-out);\n}\n.primary {\n  background-color: rgb(59, 130, 246);\n  color: white;\n  border: none;\n}\n.primary:hover {\n  background-color: rgb(37, 99, 235);\n  box-shadow: 0 6px 18px rgba(2, 6, 23, .08);\n}\n.primary:active {\n  background-color: rgb(29, 78, 216);\n  transform: translateY(1px);\n}\n.secondary {\n  background-color: white;\n  color: rgb(15, 23, 42);\n  border: 1px solid rgba(15, 23, 42, .12);\n}\n.secondary:hover {\n  background-color: rgb(241, 245, 249);\n  box-shadow: 0 6px 18px rgba(2, 6, 23, .08);\n}\n.secondary:active {\n  background-color: rgb(226, 232, 240);\n  transform: translateY(1px);\n}\n\n/* Layout helpers */\n.grid.two-col{display:grid;grid-template-columns:1fr 1fr;gap:1rem}\n@media(max-width:800px){.grid.two-col{grid-template-columns:1fr}}\n.card{padding:1rem}\n.stat{margin:.5rem 0}\n.stat-label{font-size:.9rem;opacity:.8}\n.stat-value{font-size:1.25rem;font-weight:600}\n.stat-delta{color:var(--accent,#1a7f37)}\n\n.chart{margin-bottom:1rem}\n.chart svg{height:280px;width:100%}\n.chart + .chart{margin-top:1rem}\n.chart-title{font-weight:600;text-align:center;margin-bottom:.5rem}\n.chart-note{font-size:.75rem;opacity:.8;text-align:right;margin-top:.5rem}\n.graph-divider{border-top:2px solid #e5e7eb;margin:1.5rem 0}\n.inline{display:flex;align-items:center;gap:.5rem}\n.disclaimer{font-size:.85rem;opacity:.8}\n.what-btn{font-size:.85rem;color:rgb(59,130,246);text-decoration:underline;background:none;border:none;padding:0;cursor:pointer}\n#assumptionsModal{max-width:min(760px,90vw)}\n.assumptions-body{max-height:70vh;overflow:auto}\n.contrib .chip{display:inline-block;margin:.125rem .25rem;padding:.25rem .5rem;border-radius:999px;background:var(--chip,#f1f1f1);font-size:.85rem}\n\n@media(max-width:600px){\n  .chart{margin:.5rem 0}\n  .chart svg{height:200px}\n.chart + .chart{margin-top:.5rem}\n}\n\n#methodology-content p{margin-bottom:.5rem;}\n\n"
    }
  ]
}