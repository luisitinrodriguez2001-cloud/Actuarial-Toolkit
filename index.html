<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Actuarial Toolkit</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14'>üòä</text></svg>" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script>
    window.tailwind = window.tailwind || {};
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          keyframes: {
            fadeUp: { '0%':{opacity:0,transform:'translateY(8px) scale(.98)'}, '100%':{opacity:1,transform:'translateY(0) scale(1)'}},
            shimmer: { '0%':{backgroundPosition:'-468px 0'}, '100%':{backgroundPosition:'468px 0'}},
            floaty: { '0%':{transform:'translateY(0px)'}, '50%':{transform:'translateY(-8px)'}, '100%':{transform:'translateY(0px)'} }
          },
          animation: { fadeUp:'fadeUp .4s cubic-bezier(.2,.8,.2,1) both', floaty:'floaty 6s ease-in-out infinite' },
          boxShadow: { card:'0 8px 24px rgba(2, 6, 23, .06)' }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./theme/style.css" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body class="bg-slate-50 text-slate-900 antialiased">
  <header class="max-w-5xl mx-auto px-4 py-6 bg-white/70 backdrop-blur rounded-xl shadow">
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 mb-4 animate-fadeUp">
      <div class="w-16 h-16 rounded-2xl bg-yellow-100 flex items-center justify-center text-3xl shadow bouncy select-none" aria-hidden="true" title="Hi!">üôÇ</div>
      <div class="flex-1 min-w-0">
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">Actuarial Toolkit</h1>
        <p class="text-slate-600">Crunch the numbers and outwit risk.</p>
      </div>
      <nav class="flex items-center gap-4 text-sm" aria-label="Social">
        <a class="inline-flex items-center gap-1 underline" href="https://instagram.com/luisitin2001" target="_blank" rel="noopener">Instagram</a>
        <span class="text-slate-400">&bull;</span>
        <a class="inline-flex items-center gap-1 underline" href="https://www.tiktok.com/@luisitin2001" target="_blank" rel="noopener">TikTok</a>
      </nav>
    </div>
    <div class="mt-3 flex items-center justify-between text-sm text-slate-600 px-3 py-2 bg-white/70 rounded-lg border">
      <div class="flex items-center gap-2">
        <span class="px-2 py-0.5 rounded bg-slate-100">Fun fact</span>
        <span id="fun-fact" class="animate-fadeUp text-slate-600"></span>
      </div>
      <button id="shuffle-fact" class="icon-btn hover:bg-slate-100" aria-label="Shuffle fun fact" title="Shuffle fun fact">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4" fill="currentColor">
          <path d="M7 3v2h.59L5 8.59 6.41 10 10 6.41V7h2V3H7zm10 0h4v4h-2V6.41l-3.29 3.3-1.42-1.42L17.59 5H17V3zM3 13h4v-2H3v2zm6.71 3.29 1.42 1.42L5 23h2v-2h.59l3.3-3.29-1.18-1.42zM19 14h2v4h-4v-2h1.59l-3.29-3.29 1.42-1.42L19 14.59V14z"/>
        </svg>
      </button>
    </div>
  </header>

  <div class="max-w-5xl mx-auto px-4 mb-4">
    <div class="flex items-center gap-2">
      <label for="toolSelect">Pick a tool:</label>
      <select id="toolSelect" class="field">
        <option value="longevity-lab" selected>Longevity Lab</option>
      </select>
    </div>
  </div>

  <div class="pointer-events-none fixed inset-0 overflow-hidden" aria-hidden="true">
    <div class="absolute -top-24 -left-24 w-72 h-72 rounded-full bg-gradient-to-br from-amber-200 to-pink-200 blur-3xl opacity-60 animate-floaty"></div>
    <div class="absolute -bottom-24 -right-24 w-80 h-80 rounded-full bg-gradient-to-br from-emerald-200 to-sky-200 blur-3xl opacity-60 animate-floaty" style="animation-delay:-2.2s;"></div>
  </div>

  <main class="relative">
    <section id="longevity-lab" class="card tool" aria-labelledby="longevity-title">
      <h2 id="longevity-title">Counterfactual Longevity Lab</h2>

      <p class="disclaimer" role="note">
        Population-level estimates only. Uses U.S. period life table + published hazard ratio associations.
        Not medical advice. Results are sensitive to assumptions. See ‚ÄúAssumptions &amp; Data Sources.‚Äù
      </p>

      <div class="grid two-col" id="controls">
        <div>
          <fieldset aria-describedby="disclaimer-controls">
            <legend>Profile</legend>
            <label class="inline">Age
              <button type="button" class="icon-btn" aria-label="Age info">
                i
                <span class="tooltip" role="tooltip" id="age-tip">
                  <span class="tooltip-content">Your current age. Used to look up the baseline mortality rate.</span>
                </span>
              </button>
              <input id="age" class="field" type="number" min="20" max="100" inputmode="numeric" placeholder="35" aria-describedby="age-tip" />
            </label>
            <label class="inline">Sex
              <button type="button" class="icon-btn" aria-label="Sex info">
                i
                <span class="tooltip" role="tooltip" id="sex-tip">
                  <span class="tooltip-content">Biological sex (female or male). Determines which life table (F or M) to use.</span>
                </span>
              </button>
              <select id="sex" class="field" aria-describedby="sex-tip">
                <option value="F">Female</option>
                <option value="M">Male</option>
              </select>
            </label>
          </fieldset>

            <fieldset>
              <legend>Behaviors</legend>

              <hr class="my-4" />

              <label class="inline">Smoking
                <button type="button" class="icon-btn" aria-label="Smoking info">
                  i
                  <span class="tooltip" role="tooltip" id="smoking-tip">
                    <span class="tooltip-content">Select ‚ÄòNever‚Äô if you‚Äôve never smoked, ‚ÄòCurrent‚Äô if you smoke now, or ‚ÄòFormer‚Äô if you quit.</span>
                  </span>
                </button>
                <select id="smoking" class="field" aria-describedby="smoking-tip">
                  <option value="never">Never</option>
                  <option value="current">Current</option>
                  <option value="former">Former</option>
                </select>
              </label>

              <label id="ysq-wrap" class="inline" hidden>Years since quit
                <button type="button" class="icon-btn" aria-label="Years since quit info">
                  i
                  <span class="tooltip" role="tooltip" id="ysq-tip">
                    <span class="tooltip-content">If you used to smoke, how many years ago you quit. Reduces your hazard ratio as the years increase.</span>
                  </span>
                </button>
                <input id="yearsSinceQuit" class="field" type="number" min="0" max="60" placeholder="5" aria-describedby="ysq-tip" />
              </label>

              <label id="alcohol-wrap" class="inline" hidden>Alcohol (drinks/day)
                <button type="button" class="icon-btn" aria-label="Alcohol info">
                  i
                  <span class="tooltip" role="tooltip" id="alcohol-tip">
                    <span class="tooltip-content">Average number of standard drinks you have per day.</span>
                  </span>
                </button>
                <input id="alcohol" class="field" type="number" min="0" max="10" step="0.1" placeholder="0" aria-describedby="alcohol-tip" />
              </label>

              <hr class="my-4" />

              <label class="inline">Physical activity
                <button type="button" class="icon-btn" aria-label="Physical activity info">
                  i
                  <span class="tooltip" role="tooltip" id="activity-tip">
                    <span class="tooltip-content">Select your typical weekly activity. We'll estimate MET-hours/week.</span>
                  </span>
                </button>
                <select id="activityLevel" class="field" aria-describedby="activity-tip">
                  <option value="none">Little to none</option>
                  <option value="light">1-2 days light exercise</option>
                  <option value="moderate">3-5 days moderate exercise</option>
                  <option value="high">6-7 days vigorous exercise</option>
                </select>
              </label>

              <label class="inline">Weight (lbs)
                <button type="button" class="icon-btn" aria-label="Weight info">
                  i
                <span class="tooltip" role="tooltip" id="weight-tip">
                  <span class="tooltip-content">Your weight in pounds (lbs). Used to compute Body Mass Index (BMI).</span>
                </span>
              </button>
              <input id="weight" class="field" type="number" min="50" max="1000" step="0.1" placeholder="160" aria-describedby="weight-tip" />
            </label>

              <label class="inline">Height
                <button type="button" class="icon-btn" aria-label="Height info">
                  i
                  <span class="tooltip" role="tooltip" id="height-tip">
                    <span class="tooltip-content">Your height in feet and inches. Also used to compute BMI.</span>
                  </span>
                </button>
                <div class="flex items-center gap-2">
                  <input id="heightFeet" class="field w-16" type="number" min="3" max="8" step="1" placeholder="5" aria-label="Height feet" aria-describedby="height-tip" /> <span>ft</span>
                  <input id="heightInches" class="field w-16" type="number" min="0" max="11" step="1" placeholder="9" aria-label="Height inches" aria-describedby="height-tip" /> <span>in</span>
                </div>
              </label>

              <hr class="my-4" />

              <small class="disclaimer">
                Associations, not causation. Hazard ratios drawn from large cohort/meta analyses; simplifications apply.
              </small>
            </fieldset>

          <fieldset id="screening_fs">
            <legend class="inline">Preventive screening
              <button type="button" class="icon-btn" aria-label="Preventive screening info">
                i
                <span class="tooltip" role="tooltip" id="screening-tip">
                  <span class="tooltip-content">Adds extra life-years based on USPSTF recommendations.</span>
                </span>
              </button>
            </legend>
            <label id="crc_wrap" hidden>
              <input type="checkbox" id="crc_screen" />
              Have you gotten a colorectal screening done?
              <span class="block text-slate-600 text-sm">Helps detect colorectal cancer early.</span>
            </label>
            <label id="breast_wrap" hidden>
              <input type="checkbox" id="breast_screen" />
              Have you gotten a breast cancer screening done?
              <span class="block text-slate-600 text-sm">Helps detect breast cancer early.</span>
            </label>
            <small class="disclaimer">Modeled as additive life-years/QALYs from published decision analyses.</small>
          </fieldset>

          <label class="inline">
            <input id="qualityToggle" type="checkbox" aria-describedby="quality-tip" />
            Show quality-adjusted years
            <button type="button" class="icon-btn" aria-label="Quality adjusted years info">
              i
              <span class="tooltip" role="tooltip" id="quality-tip">
                <span class="tooltip-content">When on, uses healthy life expectancy (HALE) and QALY gains instead of plain life expectancy.</span>
              </span>
            </button>
          </label>

          <div class="actions">
            <button id="runBtn" class="primary">Recalculate</button>
            <button id="assumptionsBtn" type="button" class="secondary">Assumptions &amp; Data Sources</button>
          </div>
          <small id="disclaimer-controls" class="disclaimer">
            This tool uses a period life table (mortality held constant at observed year), proportional-hazards scaling,
            and screening deltas from external models. It is not personalized medical guidance.
          </small>
        </div>

        <div id="summary" aria-live="polite">
          <div class="stat">
            <div class="stat-label">Life expectancy (age)</div>
            <div class="stat-value">
              <span id="le_baseline">‚Äì</span> ‚Üí <span id="le_adjusted">‚Äì</span>
            </div>
            <div class="stat-delta"><span id="le_delta">+0.0</span> years</div>
          </div>

          <div class="stat" id="hale-row" hidden>
            <div class="stat-label">Healthy life expectancy</div>
            <div class="stat-value">
              <span id="hale_baseline">‚Äì</span> ‚Üí <span id="hale_adjusted">‚Äì</span>
            </div>
            <div class="stat-delta"><span id="hale_delta">+0.0</span> years</div>
          </div>

          <div id="contrib" class="contrib"></div>

          <div class="actions">
            <button id="downloadCsv" type="button">Download CSV</button>
            <button id="shareState" type="button">Share</button>
          </div>

          <small class="disclaimer">
            CSV includes this disclaimer and method summary in its header rows. Interpret with caution.
          </small>
        </div>
      </div>

      <div class="chart" id="survivalChart" aria-label="Survival curves baseline vs adjusted"></div>
      <div class="chart" id="cdfChart" aria-label="Cumulative probability of death by age"></div>

      <dialog id="assumptionsModal" aria-labelledby="assumptionsTitle">
        <h3 id="assumptionsTitle">Assumptions &amp; Data Sources</h3>
        <div id="assumptionsBody" class="assumptions-body">
          <p><strong>Method:</strong> Period U.S. life table ‚Üí annual hazards; apply behavior hazard ratios multiplicatively (proportional hazards). Preventive screenings added as life-years/QALYs from published models. HALE via Sullivan method: person-years weighted by ‚Äúhealthy‚Äù prevalence.</p>

          <p><strong>Data files used in this app (static JSON):</strong></p>
          <ul>
            <li><code>data/lifetable_US_2022.json</code> ‚Äî Period life table (qx by age/sex), adapted from U.S. NCHS 2022 life table.</li>
            <li><code>data/hr_physical_activity.json</code> ‚Äî Relative risks by MET-hours/week bins from pooled cohort analysis.</li>
            <li><code>data/hr_bmi.json</code> ‚Äî BMI category hazard ratios (never-smokers reference ‚âà 22.5‚Äì&lt;25).</li>
            <li><code>data/hr_smoking.json</code> ‚Äî Current smoker HR and former-smoker HR decay by years-since-quit.</li>
            <li><code>data/hr_alcohol.json</code> ‚Äî Dose-response HR vs drinks/day, conservative (no protective effect).</li>
            <li><code>data/screening_crc.json</code>, <code>data/screening_breast.json</code> ‚Äî Life-years/QALYs gained per 1,000 screened.</li>
            <li><code>data/hale_weights.json</code> ‚Äî Age-specific ‚Äúhealthy‚Äù prevalence for Sullivan HALE.</li>
          </ul>
          <p><strong>Limits &amp; Disclaimers:</strong> Associations ‚â† causation; population averages; no comorbidity interactions; period table holds future mortality trends fixed; screening deltas are model-based and simplified to per-person averages. Not medical advice.</p>
          <button id="closeAssumptions" class="secondary">Close</button>
        </div>
      </dialog>
    </section>
  </main>

  <noscript>
    <div class="max-w-xl mx-auto mt-12 p-4 rounded-xl bg-white/80 border">
      Please enable JavaScript to use the Fitness Toolkit.
    </div>
  </noscript>

  <script type="module" src="js/app.js"></script>
</body>
</html>
